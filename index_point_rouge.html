<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first three.js app</title>
		<style>
			#container {
				position : relative;
			}

			#canvas ,#canvas1 {
				position : absolute;
				left : 0;
				top : 0;
			}

		</style>
	</head>


	<body>
		<script src="three.js"></script>
		<!---<script src="script.js"></script>-->
		<script src="utils.js"></script>
		<script src="clmtrackr.js"></script>
		<div id="container">
				<video id="videoElement" width="368" height="288" autoplay loop playsinline>
					
				</video>
				<canvas id="canvas" width="368" height="288"></canvas>
				<canvas id="canvas1" width="368" height="288" style="border:1px solid #CCC;background: none"></canvas>
		</div>
			
		<script>
			function circle(x,y,rayon)
			{
				var canvas = document.getElementById("canvas1"); 
				var context = canvas.getContext("2d");
				context.beginPath();
				context.lineWidth="2";
				context.arc(x, y, rayon, 0, 2 * Math.PI);
				context.stroke();
			}
				
			function fillCircle(x,y,rayon,couleur)
			{
				var canvas = document.getElementById("canvas1");
				var context = canvas.getContext("2d");
				context.beginPath();
				context.fillStyle=couleur
				context.arc(x, y, rayon, 0, 2 * Math.PI);
				context.fill();
			}
			function clearZone(x1,y1,x2,y2)
			{
				var canvas = document.getElementById("canvas1"); 
				var context = canvas.getContext("2d");
				context.clearRect(x1,y1,x2,y2);
			}
	
		</script>
		<p>Printing coordinates of the first 10 points in facial features:</p>
		<p id="positions"></p>
		<script>
			var video=document.getElementById("videoElement");

			if (navigator.mediaDevices.getUserMedia) {       
			    navigator.mediaDevices.getUserMedia({video: true})
			  .then(function(stream) {
			    video.srcObject = stream;
			  })
			  .catch(function(err0r) {
			    console.log("Something went wrong!");
			  });
			}

			var videoInput = document.getElementById('videoElement');

			var ctracker = new clm.tracker();
			ctracker.init();
			ctracker.start(videoInput);

			function positionLoop() {
				requestAnimFrame(positionLoop);
				var positions = ctracker.getCurrentPosition();
				// do something with the positions ...
				// print the positions
				var positionString = "";
				//fillCircle(positions[27][0],positions[27][1]);
				clearZone(0,0,2000,2000);
				var taille=positions[27][1]-positions[24][1];
				fillCircle(positions[27][0],positions[27][1],taille,'#FF0000');
				var taille2=positions[32][1]-positions[29][1];
				fillCircle(positions[32][0],positions[32][1],taille2,'#FF0000');
				
				//circle(positions[27][0],positions[27][1]);
				//fillCircle(positions[27][0],positions[27][1]); 
				/*if (positions) {
					for (var p = 0;p < 30;p++) {
						positionString += "["+positions[p][0].toFixed(2)+","+positions[p][1].toFixed(2)+"]<br/>";
					}
					var x=positions[27][0];
					var y=positions[27][1];
					var pos=[x,y];
					return(pos);
				}*/
			}
			//var pos=positionLoop();
			//document.write(pos);

			var canvasInput = document.getElementById('canvas');
			var cc = canvasInput.getContext('2d');
			function drawLoop() {
				requestAnimFrame(drawLoop);
				cc.clearRect(0, 0, canvasInput.width, canvasInput.height);
				ctracker.draw(canvasInput);
			}
			//drawLoop();

			
			positionLoop();

		</script>
		
	</body>
</html>