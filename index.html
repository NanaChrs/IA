<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>My first three.js app</title>
		<style>
			#container {
				position : relative;
			}

			canvas {
				position: relative;
    			right: 0;
    			bottom: 0;

    			min-height: 80%;

			}

			#videoElement{
				position: fixed;
    			right: 0;
    			bottom: 0;
				min-width: 100%; 
    			min-height: 100%;
			}


		</style>
	</head>


	<body>
		<script src="three.js"></script>
		<!---<script src="script.js"></script>-->
		<script src="https://www.auduno.com/clmtrackr/examples/js/libs/utils.js"></script>
		<script src="https://www.auduno.com/clmtrackr/build/clmtrackr.js"></script>
		<div id="container">
				<video id="videoElement" width="368" height="288" autoplay loop playsinline>
					
				</video>
				<canvas id="canvas" width="368" height="288"></canvas>
		</div>
		<p>Printing coordinates of the first 10 points in facial features:</p>
		<p id="positions"></p>
		<script>
			 // second param is opacity, 0 => transparent
			var position=document.getElementById("videoElement");
			var scene = new THREE.Scene();
		    var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

		    renderer = new THREE.WebGLRenderer( { alpha: true } ); // init like this
			renderer.setClearColor( 0xffffff, 0 );
		    renderer.setSize( window.innerWidth, window.innerHeight);
		    document.body.appendChild( renderer.domElement );
		      var geometry = new THREE.BoxGeometry( 1, 1, 3 );
		      var material = new THREE.MeshLambertMaterial();
		      var cube = new THREE.Mesh( geometry, material );
		      scene.add( cube );
		      camera.position.z=15;

		      var lights = [];
		      lights[ 0 ] = new THREE.PointLight( 0xff00ff, 1, 0 );
		      lights[ 1 ] = new THREE.PointLight( 0xffff00, 1, 0 );
		      lights[ 2 ] = new THREE.PointLight( 0x00ffff, 1, 0 );

		      lights[ 0 ].position.set( 0, 200, 0 );
		      lights[ 1 ].position.set( 100, 200, 100 );
		      lights[ 2 ].position.set( - 100, - 200, - 100 );

		      scene.add( lights[ 0 ] );
		      scene.add( lights[ 1 ] );
		      scene.add( lights[ 2 ] );
		      

		      function animate() {
		      requestAnimationFrame( animate );
		      cube.translate.z += 1;
		      cube.rotation.y += 0.01;
		      cube.rotation.z+=0.01;
		      renderer.render( scene, camera );
		      }
			var video=document.getElementById("videoElement");

			if (navigator.mediaDevices.getUserMedia) {       
			    navigator.mediaDevices.getUserMedia({video: true})
			  .then(function(stream) {
			    video.srcObject = stream;
			  })
			  .catch(function(err0r) {
			    console.log("Something went wrong!");
			  });
			}

				var ctracker = new clm.tracker();
				ctracker.init();
				ctracker.start(document.getElementById("videoElement"));

				function positionLoop() {

					requestAnimFrame(positionLoop);
					var positions = ctracker.getCurrentPosition();
					// do something with the positions ...
					// print the positions
					cube.set.positionx(positions[60][1]);
					cube.set.positiony(positions[60][2]);
					animate();					
				}
				positionLoop();


		</script>
	</body>
</html>